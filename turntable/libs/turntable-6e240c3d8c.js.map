{"version":3,"sources":["turntable.js"],"names":["TurnTable","el","data","options","this","$el","defaultOptions","rootClass","wrapClass","maskClass","mainClass","itemClass","actionClass","actionLabel","radius","lineWidth","lineColor","outerLineWidth","fillColors","defaultSelected","duration","delay","speed","timingFunction","renderItem","idx","item","t","document","createElement","innerHTML","lottery","length","Math","round","random","handleLotteryResult","alert","key","prototype","__initialize","className","indexOf","$wrap","appendChild","$canvas","$main","$action","style","width","height","render","afterRender","clear","drawMask","context","getContext","l","r","deg","PI","translate","i","save","beginPath","moveTo","arc","lineTo","closePath","strokeStyle","fillStyle","fill","stroke","restore","drawMain","fm","createDocumentFragment","transform","startLottery","result","that","setAttribute","counts","parseInt","getAttribute","rotation","setTimeout","removeAttribute","onclick","currentSelected","transitionDelay","transitionDuration","transitionTimingFunction","init","turntable"],"mappings":"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","file":"turntable-6e240c3d8c.js","sourcesContent":["'use strict';\r\n\r\nvar TurnTable = function(el, data, options) {\r\n  this.$el = el;\r\n  this.data = data || [];\r\n  this.defaultOptions = {\r\n    rootClass: 'turntable',\r\n    wrapClass: 'turntable-wrap',\r\n    maskClass: 'turntable-mask',\r\n    mainClass: 'turntable-main',\r\n    itemClass: 'turntable-item',\r\n    actionClass: 'turntable-action',\r\n    actionLabel: '抽奖',\r\n    radius: 100,\r\n    lineWidth: 1,\r\n    lineColor: '#E44025',\r\n    outerLineWidth: 5,\r\n    fillColors: ['#FFB820', '#FFCB3F'],\r\n    defaultSelected: 0,\r\n    duration: 5000,\r\n    delay: 100,\r\n    speed: 3600,\r\n    timingFunction: 'ease-in-out',\r\n    renderItem: function(idx, item) {\r\n      var t = document.createElement('span');\r\n      t.innerHTML = item;\r\n      return t;\r\n    },\r\n    lottery: function(data) {\r\n      data = data || [];\r\n\r\n      if (data.length <= 0) {\r\n        return -1;\r\n      }\r\n\r\n      return Math.round(Math.random() * data.length - 1);\r\n    },\r\n    handleLotteryResult: function(idx, item) {\r\n      alert('data[' + idx + '] = ' + item);\r\n    }\r\n  };\r\n  this.options = {};\r\n  for (var key in this.defaultOptions) {\r\n    this.options[key] = options[key] || this.defaultOptions[key];\r\n  }\r\n};\r\n\r\nTurnTable.prototype = {\r\n  __initialize: function() {\r\n    if (this.$el.className.indexOf(this.options.rootClass) < 0) {\r\n      this.$el.className = this.$el.className + ' ' + this.options.rootClass;\r\n    }\r\n\r\n    this.$wrap = document.createElement('div');\r\n    this.$wrap.className = this.options.wrapClass;\r\n    this.$el.appendChild(this.$wrap);\r\n\r\n    this.$canvas = document.createElement('canvas');\r\n    this.$canvas.className = this.options.maskClass;\r\n    this.$wrap.appendChild(this.$canvas);\r\n\r\n    this.$main = document.createElement('ul');\r\n    this.$main.className = this.options.mainClass;\r\n    this.$wrap.appendChild(this.$main);\r\n\r\n    this.$action = document.createElement('span');\r\n    this.$action.className = this.options.actionClass;\r\n    this.$action.innerHTML = this.options.actionLabel;\r\n    this.$el.appendChild(this.$action);\r\n\r\n    this.$el.style.width = this.$el.style.height = this.$wrap.style.width = this.$wrap.style.height = this.$main.style.width = this.$main.style.height =\r\n      this.options.radius * 2 + 'px';\r\n\r\n    this.$canvas.width = this.$canvas.height = this.options.radius * 2;\r\n\r\n    this.render();\r\n    this.afterRender();\r\n  },\r\n  clear: function() {},\r\n  drawMask: function() {\r\n    var context = this.$canvas.getContext('2d'),\r\n      l = this.data.length;\r\n\r\n    if (l <= 0) {\r\n      return;\r\n    }\r\n\r\n    var r = 360 / l,\r\n      deg = Math.PI / 180;\r\n\r\n    context.translate(this.options.radius, this.options.radius);\r\n\r\n    // 绘制圆\r\n    for (var i = 0; i < l; i++) {\r\n      context.save();\r\n      context.beginPath();\r\n      context.moveTo(0, 0);\r\n      // 画出圆弧\r\n      context.arc(\r\n        0,\r\n        0,\r\n        this.options.radius - this.options.lineWidth / 2,\r\n        (i * r - r / 2 - 90) * deg,\r\n        ((i + 1) * r - r / 2 - 90) * deg\r\n      );\r\n\r\n      // 连接到圆心\r\n      context.lineTo(0, 0);\r\n      context.closePath();\r\n\r\n      context.lineWidth = this.options.lineWidth;\r\n      context.strokeStyle = this.options.lineColor;\r\n      context.fillStyle = this.options.fillColors[\r\n        i % this.options.fillColors.length\r\n      ];\r\n\r\n      context.fill();\r\n      context.stroke();\r\n      context.restore();\r\n    }\r\n\r\n    // 绘制圆外圈\r\n    context.beginPath();\r\n    context.arc(\r\n      0,\r\n      0,\r\n      this.options.radius - this.options.outerLineWidth / 2,\r\n      0,\r\n      360 * deg\r\n    );\r\n    context.strokeStyle = this.options.lineColor;\r\n    context.lineWidth = this.options.outerLineWidth;\r\n    context.stroke();\r\n  },\r\n  drawMain: function() {\r\n    var l = this.data.length;\r\n\r\n    if (l <= 0) {\r\n      return;\r\n    }\r\n\r\n    var r = 360 / l;\r\n\r\n    var fm = document.createDocumentFragment();\r\n    for (var i = 0; i < l; i++) {\r\n      var item = document.createElement('li');\r\n      item.className = this.options.itemClass;\r\n      item.appendChild(this.options.renderItem(i, this.data[i]));\r\n\r\n      item.style.transform = 'rotate(' + -r * i + 'deg)';\r\n\r\n      fm.appendChild(item);\r\n    }\r\n\r\n    this.$main.appendChild(fm);\r\n  },\r\n\r\n  startLottery: function(result) {\r\n    var that = this;\r\n\r\n    result = result || that.options.lottery(that.data);\r\n\r\n    if (result < 0) {\r\n      return;\r\n    }\r\n\r\n    that.$action.setAttribute('data-disabled', true);\r\n    that.$action.className = that.options.actionClass + ' disabled';\r\n\r\n    var counts = parseInt(that.$wrap.getAttribute('data-counts'));\r\n    var r = 360 / that.data.length;\r\n    var rotation = (counts + 1) * that.options.speed + result * r;\r\n\r\n    that.$wrap.style.transform = 'rotate(' + rotation + 'deg)';\r\n    that.$wrap.setAttribute('data-counts', counts + 1);\r\n\r\n    setTimeout(function() {\r\n      that.$action.removeAttribute('data-disabled', true);\r\n      that.$action.className = that.options.actionClass;\r\n\r\n      that.options.handleLotteryResult(result, that.data[result]);\r\n    }, that.options.duration);\r\n  },\r\n\r\n  render: function() {\r\n    var that = this;\r\n    that.clear();\r\n    that.drawMask();\r\n    that.drawMain();\r\n\r\n    that.$action.onclick = function() {\r\n      if (that.$action.getAttribute('data-disabled')) {\r\n        return;\r\n      }\r\n\r\n      that.startLottery();\r\n    };\r\n  },\r\n  afterRender: function() {\r\n    var l = this.data.length;\r\n\r\n    if (l <= 0) {\r\n      return;\r\n    }\r\n\r\n    var r = 360 / l;\r\n\r\n    this.currentSelected =\r\n      this.options.defaultSelected >= l ? l : this.options.defaultSelected;\r\n\r\n    this.$wrap.style.transform = 'rotate(' + this.currentSelected * r + 'deg)';\r\n    this.$wrap.setAttribute('data-counts', 0);\r\n\r\n    this.$wrap.style.transitionDelay = this.options.delay / 1000 + 's';\r\n    this.$wrap.style.transitionDuration = this.options.duration / 1000 + 's';\r\n    this.$wrap.style.transitionTimingFunction = this.options.timingFunction;\r\n  }\r\n};\r\n\r\nTurnTable.init = function(el, data, options) {\r\n  var turntable = new TurnTable(el, data, options);\r\n  turntable.__initialize();\r\n  return turntable;\r\n};\r\n"]}