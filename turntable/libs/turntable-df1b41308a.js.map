{"version":3,"sources":["turntable.js"],"names":["Turntable","el","data","options","this","$el","defaultOptions","rootClass","wrapClass","maskClass","mainClass","itemClass","actionClass","actionLabel","radius","lineWidth","lineColor","outerLineWidth","fillColors","defaultSelected","duration","delay","speed","timingFunction","renderItem","idx","item","t","document","createElement","innerHTML","lottery","length","Math","round","random","handleLotteryResult","alert","key","prototype","__initialize","className","indexOf","$wrap","appendChild","$canvas","$main","$action","style","width","height","render","afterRender","clear","drawMask","context","getContext","l","r","deg","PI","translate","i","save","beginPath","moveTo","arc","lineTo","closePath","strokeStyle","fillStyle","fill","stroke","restore","drawMain","fm","createDocumentFragment","transform","startLottery","result","that","setAttribute","counts","parseInt","getAttribute","rotation","setTimeout","removeAttribute","onclick","currentSelected","transitionDelay","transitionDuration","transitionTimingFunction","init","turntable"],"mappings":"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","file":"turntable-df1b41308a.js","sourcesContent":["'use strict';\n\nvar Turntable = function(el, data, options) {\n  this.$el = el;\n  this.data = data || [];\n  this.defaultOptions = {\n    rootClass: 'turntable',\n    wrapClass: 'turntable-wrap',\n    maskClass: 'turntable-mask',\n    mainClass: 'turntable-main',\n    itemClass: 'turntable-item',\n    actionClass: 'turntable-action',\n    actionLabel: '抽奖',\n    radius: 100,\n    lineWidth: 1,\n    lineColor: '#E44025',\n    outerLineWidth: 5,\n    fillColors: ['#FFB820', '#FFCB3F'],\n    defaultSelected: 0,\n    duration: 5000,\n    delay: 100,\n    speed: 3600,\n    timingFunction: 'ease-in-out',\n    renderItem: function(idx, item) {\n      var t = document.createElement('span');\n      t.innerHTML = item;\n      return t;\n    },\n    lottery: function(data) {\n      data = data || [];\n\n      if (data.length <= 0) {\n        return -1;\n      }\n\n      return Math.round(Math.random() * data.length - 1);\n    },\n    handleLotteryResult: function(idx, item) {\n      alert('data[' + idx + '] = ' + item);\n    }\n  };\n  this.options = {};\n  for (var key in this.defaultOptions) {\n    this.options[key] = options[key] || this.defaultOptions[key];\n  }\n};\n\nTurntable.prototype = {\n  __initialize: function() {\n    if (this.$el.className.indexOf(this.options.rootClass) < 0) {\n      this.$el.className = this.$el.className + ' ' + this.options.rootClass;\n    }\n\n    this.$wrap = document.createElement('div');\n    this.$wrap.className = this.options.wrapClass;\n    this.$el.appendChild(this.$wrap);\n\n    this.$canvas = document.createElement('canvas');\n    this.$canvas.className = this.options.maskClass;\n    this.$wrap.appendChild(this.$canvas);\n\n    this.$main = document.createElement('ul');\n    this.$main.className = this.options.mainClass;\n    this.$wrap.appendChild(this.$main);\n\n    this.$action = document.createElement('span');\n    this.$action.className = this.options.actionClass;\n    this.$action.innerHTML = this.options.actionLabel;\n    this.$el.appendChild(this.$action);\n\n    this.$el.style.width = this.$el.style.height = this.$wrap.style.width = this.$wrap.style.height = this.$main.style.width = this.$main.style.height =\n      this.options.radius * 2 + 'px';\n\n    this.$canvas.width = this.$canvas.height = this.options.radius * 2;\n\n    this.render();\n    this.afterRender();\n  },\n  clear: function() {},\n  drawMask: function() {\n    var context = this.$canvas.getContext('2d'),\n      l = this.data.length;\n\n    if (l <= 0) {\n      return;\n    }\n\n    var r = 360 / l,\n      deg = Math.PI / 180;\n\n    context.translate(this.options.radius, this.options.radius);\n\n    // 绘制圆\n    for (var i = 0; i < l; i++) {\n      context.save();\n      context.beginPath();\n      context.moveTo(0, 0);\n      // 画出圆弧\n      context.arc(\n        0,\n        0,\n        this.options.radius - this.options.lineWidth / 2,\n        (i * r - r / 2 - 90) * deg,\n        ((i + 1) * r - r / 2 - 90) * deg\n      );\n\n      // 连接到圆心\n      context.lineTo(0, 0);\n      context.closePath();\n\n      context.lineWidth = this.options.lineWidth;\n      context.strokeStyle = this.options.lineColor;\n      context.fillStyle = this.options.fillColors[\n        i % this.options.fillColors.length\n      ];\n\n      context.fill();\n      context.stroke();\n      context.restore();\n    }\n\n    // 绘制圆外圈\n    context.beginPath();\n    context.arc(\n      0,\n      0,\n      this.options.radius - this.options.outerLineWidth / 2,\n      0,\n      360 * deg\n    );\n    context.strokeStyle = this.options.lineColor;\n    context.lineWidth = this.options.outerLineWidth;\n    context.stroke();\n  },\n  drawMain: function() {\n    var l = this.data.length;\n\n    if (l <= 0) {\n      return;\n    }\n\n    var r = 360 / l;\n\n    var fm = document.createDocumentFragment();\n    for (var i = 0; i < l; i++) {\n      var item = document.createElement('li');\n      item.className = this.options.itemClass;\n      item.appendChild(this.options.renderItem(i, this.data[i]));\n\n      item.style.transform = 'rotate(' + -r * i + 'deg)';\n\n      fm.appendChild(item);\n    }\n\n    this.$main.appendChild(fm);\n  },\n\n  startLottery: function(result) {\n    var that = this;\n\n    result = result || that.options.lottery(that.data);\n\n    if (result < 0) {\n      return;\n    }\n\n    that.$action.setAttribute('data-disabled', true);\n    that.$action.className = that.options.actionClass + ' disabled';\n\n    var counts = parseInt(that.$wrap.getAttribute('data-counts'));\n    var r = 360 / that.data.length;\n    var rotation = (counts + 1) * that.options.speed + result * r;\n\n    that.$wrap.style.transform = 'rotate(' + rotation + 'deg)';\n    that.$wrap.setAttribute('data-counts', counts + 1);\n\n    setTimeout(function() {\n      that.$action.removeAttribute('data-disabled', true);\n      that.$action.className = that.options.actionClass;\n\n      that.options.handleLotteryResult(result, that.data[result]);\n    }, that.options.duration);\n  },\n\n  render: function() {\n    var that = this;\n    that.clear();\n    that.drawMask();\n    that.drawMain();\n\n    that.$action.onclick = function() {\n      if (that.$action.getAttribute('data-disabled')) {\n        return;\n      }\n\n      that.startLottery();\n    };\n  },\n  afterRender: function() {\n    var l = this.data.length;\n\n    if (l <= 0) {\n      return;\n    }\n\n    var r = 360 / l;\n\n    this.currentSelected =\n      this.options.defaultSelected >= l ? l : this.options.defaultSelected;\n\n    this.$wrap.style.transform = 'rotate(' + this.currentSelected * r + 'deg)';\n    this.$wrap.setAttribute('data-counts', 0);\n\n    this.$wrap.style.transitionDelay = this.options.delay / 1000 + 's';\n    this.$wrap.style.transitionDuration = this.options.duration / 1000 + 's';\n    this.$wrap.style.transitionTimingFunction = this.options.timingFunction;\n  }\n};\n\nTurntable.init = function(el, data, options) {\n  var turntable = new Turntable(el, data, options);\n  turntable.__initialize();\n  return turntable;\n};\n"]}